[gd_scene load_steps=11 format=3 uid="uid://cbsyhilap3cwq"]

[ext_resource type="Texture2D" uid="uid://dqaehttexexqh" path="res://assets/prototype/Dark/texture_01.png" id="1_4b6k7"]
[ext_resource type="PackedScene" uid="uid://dt0hn2cgtf5g1" path="res://scenes/player/player.tscn" id="2_vjugs"]
[ext_resource type="PackedScene" uid="uid://ifllmt2qup1j" path="res://scenes/dummy_items/dummy_item.tscn" id="3_mv177"]
[ext_resource type="PackedScene" uid="uid://b364sm28y051l" path="res://scenes/cooking/patty.tscn" id="4_uwmcd"]
[ext_resource type="PackedScene" uid="uid://coef8d8g3xjex" path="res://scenes/cooking/stove.tscn" id="5_vjugs"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_8a5hx"]

[sub_resource type="Sky" id="Sky_0huwb"]
sky_material = SubResource("ProceduralSkyMaterial_8a5hx")

[sub_resource type="Environment" id="Environment_uyg78"]
background_mode = 2
sky = SubResource("Sky_0huwb")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_8a5hx"]
albedo_texture = ExtResource("1_4b6k7")
uv1_scale = Vector3(20, 20, 20)

[sub_resource type="GDScript" id="GDScript_vjugs"]
script/source = "extends Area3D

enum State {RAW, COOKING, COOKED, BURNT} # states of patty
var state = State.RAW
# cooking times
var cooking_time : float = 0.0 
var max_cooking_time: float = 10.0
var burn_time: float = 20.0
# is patty on stove
var is_on_stove: bool = false
# status of print messages
var cooked_printed: bool = false
var burnt_printed: bool = false
func _ready():
	# Cache the mesh material for quick access
	print(\"Patty script ready!\")
	$MeshInstance3D.material_override = $MeshInstance3D.get_active_material(0)
	
func start_cooking (): # cooking function
	if is_on_stove: # if its on the stove already its already cooking
		return
	is_on_stove = true
	if(state == State.RAW): # check if patty is raw
		state = State.COOKING # change state of patty to cooking
		is_on_stove = true
		cooking_time = 0.0
		print (\"Patty is cooking on stove.\")
	elif state == State.COOKING or state == State.COOKED:
		print (\"Patty resume cooking\")
		
func stop_cooking (): # when the patty stops cooking
	is_on_stove = false
	print (\"Patty stopped cooking.\")
	
func _process (delta):
	if (is_on_stove): # check if its in cooking state
		cooking_time += delta # adds time passed since last frame
		
		if (cooking_time >= max_cooking_time and state != State.COOKED  and not cooked_printed) : # if the time reaches 10 seconds it is cooked
			state = State.COOKED
			_change_patty_color(Color(0.424, 0.235, 0.03, 1.0)) # turn brown
			print (\"Patty is cooked\")
			cooked_printed = true

		if cooking_time >= burn_time and state != State.BURNT and not burnt_printed: # if the time is greater than 20 seocnds the patty state is burnt
			state = State.BURNT
			_change_patty_color(Color(0.069, 0.023, 0.001, 1.0)) # turn black
			print (\"Patty is burnt\")
			burnt_printed = true
			
func _change_patty_color(new_color: Color):
	var mat = $MeshInstance3D.get_active_material(0)
	if mat:
		mat.albedo_color = new_color
"

[node name="CookingWorld" type="Node3D"]

[node name="TestWorld" type="Node3D" parent="."]

[node name="WorldEnvironment" type="WorldEnvironment" parent="TestWorld"]
environment = SubResource("Environment_uyg78")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="TestWorld"]
transform = Transform3D(1, 0, 0, 0, 0.7875807, 0.6162115, 0, -0.6162115, 0.7875807, 0, 1.9818738, 0)
shadow_enabled = true

[node name="CSGBox3D" type="CSGBox3D" parent="TestWorld"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.031198978, -0.3348794, -0.21556234)
use_collision = true
collision_layer = 2
size = Vector3(39.45375, 0.29052734, 48.29338)
material = SubResource("StandardMaterial3D_8a5hx")

[node name="Player" parent="TestWorld" instance=ExtResource("2_vjugs")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.20424843, 0.7905276, -0.32461023)

[node name="DummyItem" parent="TestWorld" instance=ExtResource("3_mv177")]
transform = Transform3D(0.3, 0, 0, 0, 0.3, 0, 0, 0, 0.3, 3.5246434, -0.07216641, -5.3740287)

[node name="Patty" parent="TestWorld" instance=ExtResource("4_uwmcd")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.323677, 0.213934, -0.031141758)
script = SubResource("GDScript_vjugs")

[node name="Stove" parent="TestWorld" instance=ExtResource("5_vjugs")]
transform = Transform3D(0.33, 0, 0, 0, 0.33, 0, 0, 0, 0.33, 2.5762794, 0, 0)
